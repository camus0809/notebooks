# 51单片机

## 预先准备

- stc-isp中选择`STC89C52RC/LE52RC`

- keil中选择`AT89C52`
- 更改keil中文编码为UTF-8

> 51单片机上电默认为高电平

## 1. LED介绍

- 中文名：发光二极管
- 外文名：Light Emitting Diode / LED
- 用途：照明、广告灯、指引灯、屏幕

![image-20251014200441159](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014200441159.png "二极管 左为正 右为负")

![image-20251014200603910](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014200603910.png "内部的左边为小红旗/正极 右边位大红旗/负极")

开发板上

![image-20251014201114033](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014201114033.png)

> [!important]
>
> 普中开发板上的LED模块从左往右是`P2^0~P2^7`

## 2. 独立按键

![image-20251014204009802](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014204009802.png)

- 共阴极

由于单片机上电默认为高电平，但独立按键的另一端为`GND`，所以当按下按钮后，按钮的点亮被拉低，故==判断按键是否被按下的依据为：当前引脚是否为0==

- 对于机械开关，当机械触点断开、闭合时，由于机械触点的弹性作用，一个开关在闭合时**不会马上稳定地接通**，在断开的时候**也不会一下子断开**，所以在闭合或者断开的瞬间会伴随一连串的抖动

![image-20251014211416044](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014211416044.png)

### 2.1 按键消抖

在按下按键后松手实现`CODE`中的代码

```c
if(key0==0) // 判断是否按下
{
    Delayms(10);  // 消除前段的按键抖动
    while(key0 == 0); // 判断按键状态，如果是高电平证明之前是误触
    Delayms(10);  // 消除后段的按键抖动

    /* CODE */
}
```

按下按键即实现`CODE`中的代码

```c
if(KEY0 == 0)
	{
		Delayms(10); // 等待10ms消抖
		if(KEY0 == 0) // 判断是否按下
		{
			/* CODE */
		}
		while(!KEY0); // 判断是否松手
	}
```

### 2.2 延时函数

*使用stc-isp生成延时函数需注意*

- 选择的模块应是==软件延时计算器==
- 选择系统频率，即晶振频率（普中为11.0592MHz）
- 定时长度包括微秒、毫秒量级
- `8051指令集`需注意==普中A3==应选择`STC-Y1`

```c
void Delayms(unsigned int xms)		//@11.0592MHz
{
	u8 i, j;
	while(xms--)
		{
		_nop_();
		i = 2;
		j = 199;
		do
		{
			while (--j);
		} while (--i);
	}
}
```

## 3. 数码管

### 3.1 138译码器/74LS138 

![image-20251014214815508](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014214815508.png)

- ==**作用：用作位选**==

- 使用三个`io`控制8个输出

- `G1`、`G2A`、`G2B`：使能端 --> 这样上电即工作

- `C`、`B`、`A`：输入（从低位到高位）

  | C    | B    | A    | Y    |
  | ---- | ---- | ---- | ---- |
  | 0    | 0    | 0    | 0    |
  | 0    | 0    | 1    | 1    |
  | 0    | 1    | 0    | 2    |
  | 0    | 1    | 1    | 3    |
  | 1    | 0    | 0    | 4    |
  | 1    | 0    | 1    | 5    |
  | 1    | 1    | 0    | 6    |
  | 1    | 1    | 1    | 7    |



### 3.2 八位晶体管

![image-20251014215515977](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1014/image-20251014215515977.png)

- `COM`是共阴极数码管
- `74HC245`是一个双向数据缓冲器
  - `OE`: output enable
  - `CE`: chip enable
  - `DIR`: direction 方向 当前方向为`-->`  
  - 这样接的原因：**高电平驱动能力弱**，若不加led会比较暗  
  - `CC2`去耦电容
    - `104`： `10*10^4`pF
    - 滤除电源噪声：当芯片（74HC245）内部逻辑翻转时，会瞬间产生电流冲击，这会在电源线上形成电压波动。去耦电容可以在局部“提供电流”，稳定 VCC 电压。
    - 抑制高频干扰与电磁噪声：减少电源纹波、改善抗干扰性能。
  - `RP`：限流
    - 数码管的每个段都是一个 LED，正常工作时需要通过一定电流（通常 5~15mA）。若没有限流电阻，74HC245 的输出电流可能过大，**导致数码管过亮烧毁；芯片输出口电流超限，芯片损坏**
    - 电阻阵列的优势：比单个贴片电阻节省空间、布局整齐，常用于并行接口（如数码管、LED阵列、键盘行列等）。

### 3.3 数码管的驱动方式

- 单片机直接扫描：硬件设备简单，但是会耗费大量的单片机CPU时间
- 专用驱动芯片：内部自带显存、扫描电路，单片机只需告诉它显示什么即可
  - `TM1640`驱动数码管
  - `74HC595`移位寄存器

## 4. 矩阵键盘

![image-20251015111810738](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1015/image-20251015111810738.png)

- 当键盘中的按键数量较多时，为减少`I/O`的使用，通常将按键排列成矩阵形式
  - 采用逐行或逐列“扫描”，就可以读出按键的键值

单片机`I/O`口的模式为弱上拉模式

| P17  | P16  | P15  | P14  | P13  | P12  | P11  | P10  |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| r1   | r2   | r3   | r4   | c1   | c2   | c3   | c4   |

```C
unsigned char keyValue = 0;
/*
 *@brif	  矩阵键盘读取按键键码
 *@param  无
 *@retval keyValue 按下按键的键码值
					如果按下按键的一瞬返回按键键值；
					如果没有按下按键，则返回0
 */
unsigned char keyScan() // 扫描矩阵键盘
{
	P1 = 0xF0; // 行扫描
	if(P1 != 0xF0){
		Delayms(10);
		if(P1 != 0xF0)
		{
			switch(P1){
				case 0x70: keyValue = 1;break;
				case 0xB0: keyValue = 5;break;
				case 0xD0: keyValue = 9;break;
				case 0xE0: keyValue = 13;break;
			}
			P1 = 0x0F; // 列扫描
			switch(P1){
					case 0x07: keyValue += 0;break;
					case 0x0B: keyValue += 1;break;
					case 0x0D: keyValue += 2;break;
					case 0x0E: keyValue += 3;break;
			}
            while(P1!=0x0F);// 松手检测
		}
	}
	return keyValue;
}
```

## 5. 定时器

属于单片机的内部资源，其电路的连接与运转均在单片机内部完成

### 5.1 定时器的作用

1. 用于计时系统，可实现软件计时，或者使程序每隔固定时间完成一项操作
2. 代替长时间的Delay函数，提高CPU的运行和处理速度

### 5.2 STC89C52定时器资源

定时器个数：3个（T0、T1、T2），前两者与传统的51单片机兼容，T2是增加的资源

### 5.3 定时器工作模式

T0和T1均有四种工作模式

- 模式0：13位定时器/计数器
- 模式1：（常用）16位定时器/计数器
- 模式2：8位自动重载
- 模式3：两个6位计数器

**模式1 16位定时器/计数器**

![image-20251015213941081](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1015/image-20251015213941081.png)

1. 定时器时钟

- `SYSclk`：系统时钟，即==晶振周期==
  - `MCU in 12T mode`：计时器每隔1/（11.0592/12）

2. 中断系统

- 为使CPU具有对外界紧急事件的实时处理能力而设置的
- STM89C52的中断资源
  1. 中断源个数：8个（外部中断0,定时器中断0，外部中断1, 定时器中断1, 串口中断，外部中断2,外部中断3）
  2. 中断优先级个数：4

**计时器  晶振频率为11.0592Mhz，每隔1.085us计数加一**

### 5.4 中断系统

![image-20251021144513155](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1021/image-20251021144513155.png)

由于使用的为**定时器0即`Timer0`**,所以初始化需要做的是

1. `TF0`为定时器0的中断请求标志位，当定时器寄存器`TH0`/`TL0`溢出时，溢出标志位`TF0`会被置位，定时器中断发生。当单片机转去执行`T0`中断时，定时器的溢出标志位`TF0`会被==硬件清零==，无须软件操作
2. `IE`寄存器：中断允许寄存器 **可位寻址**
   1. `EA = 1`,CPU的总中断允许控制位，作用为使中断允许形成两级控制，即**==各中断源首先受`EA`控制，其次还受各中断源自己的中断允许控制位控制==**
   2. `ET0 = 1`为`T0`的溢出中断允许位，`ET0=1`即允许`T0`中断
3. `TCON`定时器/计数器终端控制寄存器 **可位寻址**
   1. `TF0`：`T0`溢出中断标志。`T0`被允许计数后，从初值开始执行加1操作，当产生溢出时，由硬件置1
   2. `TR0` = 1：定时器0的运行控制位
4. 中断函数，由于是`T0`，故为

```c
void Timer0_Rountine() interrupt 1
```

5. 定时器/计数器工作模式寄存器`TMOD` **不可位寻址**

   ![image-20251021173201646](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1021/image-20251021173201646.png)

| M1   | M0   | 模式                                                        |
| ---- | ---- | ----------------------------------------------------------- |
| 0    | 0    | 13位定时器/计数器，TLx（x= 0, 1）只用低5位参与分频          |
| 0    | 1    | 16位定时器/计数器，TLx和THx全用                             |
| 1    | 0    | 8位自动重装载定时器，当溢出时将`TH0`存放的值自动重装入`TL0` |
| 1    | 1    | 定时器/计数器1此时无效（停止计数）                          |

## 6. 串口通信

​	内部集成有一个功能很强的全双工串行通信口，与传统8051单片机的串口完全兼容。设有==两个相互独立的接收、发送缓冲器==，可以同时发送和接收数据。发送缓冲器只能写入而不能读出，接收缓冲器只能读出而不能写入，**因此两个缓冲器可以共用一个地址码（99H）**。两个缓冲器统称==串行通信特殊功能寄存器SBUF==

- 串行通信设有4种工作方式，其中两种方式的波特率是可变的，另两种是固定的，以供不同应用场合选用。**波特率由内部定时器/计数器产生**，是软件设置不同的波特率和选择不同的工作方式。主机可通过查询或中断方式对接收/发送进行程序处理，使用十分灵活
- 对应管脚 --> P3.0/RxD和P3.1/TxD
- 单片机的串行通信口，除用于数据通信外，还可方便地构成**一个或多个并行I/O口，或作串一并转换，或用于扩展串行外设等**

### 6.1 串口介绍

1. 串口是一种应用十分广泛的通信接口，成本低、容易使用、通信线路简单，可实现两个设备的相互通信
2. 单片机的串口可以和单片机、电脑、各种各样的模块相互通信，极大扩展了单片机的应用范围，增强了单片机系统的硬件实力
3. 51==自带UART（通用异步收发器）==，可实现单片机的串口通信



### 6.2 串行口相关寄存器

- `SCON` 串行控制寄存器 **可位寻址**

![image-20251021214816038](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1021/image-20251021214816038.png)

1. `SM0/FE`: 与`PCON.6`联动
   1. 若`SMOD/PCON.6`为1时，该位用于**帧错误检测**。当检测到一个无效停止位时，通过`UART`接收器设置该位。==必须由软件清零==
   2. 若`SCOMN/PCON.6`为0时，该位与`SM1`一起指定串行通信方式

| SM0  | SM1  | 工作方式 |           功能说明           |               波特率                |
| :--: | :--: | :------: | :--------------------------: | :---------------------------------: |
|  0   |  0   |  方式0   | 同步移位串行方式：移位寄存器 |         波特率是`SYSclk/12`         |
|  0   |  1   |  方式1   |     8位UART，波特率可变      |   (2^SMOD^/32)x(定时器1的溢出率)    |
|  1   |  0   |  方式2   |           9位UART            | (2^SMOD^/64)xSYSclk系统工作时钟频率 |
|  1   |  1   |  方式3   |     9位UART，波特率可变      |   (2^SMOD^/32)x(定时器1的溢出率)    |

2. `REN`：允许/禁止串行接收控制位。由软件置位`REN`，即`REN=1`为允许串行接收状态，可启动串行接收器`RxD`，开始接收消息。软件复位`REN=0`,则禁止接收
3. `TI`：发送中断请求标志位。在**方式0**,当串行发送数据第八位结束时，由==内部硬件自动置位==，即`TI=1`，向主机请求中断，响应中断后**==必须用软件复位==**，即`TI=0`。在其他方式中，则在停止位开始发送时由内部硬件置位`TI=1`'，必须用软件置位`TI=0`
4. `RI`：接收中断请求标志位。在**方式0**，当串行接收到第八位结束时，由==内部硬件自动置位==，即`RI=1`，向主机请求中断，响应中断后**==必须用软件复位==**，即`RI=0`。在其他方式中，则在停止位开始发送时由内部硬件置位`RI=1`，必须用软件置位`RI=0`

- `PCON`：电源控制寄存器 **不可位寻址**

![image-20251021225200172](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1021/image-20251021225200172.png)

1. `SMOD`：波特率选择位。当用软件置位`SMOD`，即`SMOD=1`时，串行通信方式1、2、3的波特率加倍；`SMOD=0`时各个工作方式波特率加倍。复位时`SMOD=0`
2. `SMOD0`：帧错误检测有效位。当`SMOD0=1`，`SCON`寄存器中的`SM0/FE`用于`FE`（frame error 帧错误）功能；当`SMOD0=0`，用于指定串口通信的工作方式。复位时`SMOD0=0`

- `TCON`：由于需要使用定时器1,故需
  - `TR1=1`：打开定时器1的运行控制位
- `TMOD`：将定时器1配置为8位自动重载工作模式
  - 因为它可以自动重载初始值，无须中断服务程序干预，从而产生非常稳定、准确的波特率

- `SBUF`串行口数据缓冲寄存器

1. 实际时**两个**缓冲器，一个为**只读寄存器**，一个为**只写寄存器**
2. 串行通道内设有数据寄存器。在所有的串行通信方式中，写入`SBUF`信号的控制下，把数据装入相同的9位寄存器，==前八位为数据字节，最低位为移位寄存器的输出位==。其中最低位会根据不同的工作方式自动装入。
3. 串行通道的接收寄存器是一个输入移位寄存器。==方式0==它的字节为8位，其他方式为9位。
4. 由于接收通道内有移位寄存器和`SBUF`缓冲器，从而能使一帧接收完将数据由移位寄存器装入`SBUF`后，可立即开始接收下一帧信息，主机应在该帧接收结束前从`SBUF`中将数据取走避免丢失上一帧的数据。`SBUF`以**并行方式**送往内部数据总线

### 6.3 硬件电路`UART`

- 简单双向串口有两根通信线（TXD和RXD）
- TXD与RXD要交叉连接
- 当只需单向的数据传输时，可以只连接一根通信线
- 当电平标准不一致时，需要加电平转换芯片
- **一定要接`GND`**，如果两个设备均有独立电源可以不接`VCC`

![image-20251016193519704](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016193519704.png)

### 6.4 电平标准

- 电平标准时数据1和数据0的表达方式，是传输线缆中认为规定的电压与数据的对应关系

  - TTL电平：+5v-->1    0-->0  稳定性最差
  - RS232电平：-3~-15v-->1    +3~+15v-->0   一般用于电脑
  - RS485电平：两线压差+2~+6v-->1    -2~-6-->0 差分信号 传输距离很远

  > CAN总线也是差分信号

### 6.5 接口及引脚定义

DB9接口

![image-20251016195823257](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016195823257.png)

- `DTR数据终端准备好`、`DSR数据准备好`、`RTS请求发送`、`CTS清楚发送`是用于**数据流控制** （51不支持）

VGA接口

### 6.6 常见通信接口比较

| 名称   | 引脚定义             | 通信方式     | 特点           |
| ------ | -------------------- | ------------ | -------------- |
| UART   | TxD、RxD             | 全双工、异步 | 点对点通信     |
| IIC    | SCL、SDA             | 半双工、同步 | 可挂载多个设备 |
| SPI    | SCLK、MOSI、MISO、CS | 全双工、同步 | 可挂载多个设备 |
| 1-wire | DQ                   | 半双工、异步 | 可挂载多个设备 |

- 此外 还有*CAN、USB*等

- 相关术语

  - 全双工：通信双方可以在同一时刻互相传输数据
  - 半双工：通信双方可以互相传输数据，但必须分时复用一根数据线
  - 单工：通信只能由一方发送到另一方，不能反向传输

  

  - 异步：通信双方各自约定通信速率
  - 同步：通信双方靠一根时钟线来约定速率 ==（有时钟线）==

  

  - 总线：连接各个设备的数据传输线路

### 6.7 串口参数及时序图

- 波特率串口通信的速率（发送和接收各数据位的间隔时间）
- 检验位：用于数据验证
- 停止位：用于数据帧间隔

> 比特率

![image-20251016201600227](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016201600227.png)

### 6.8 串口模式图

- SBUF：串口数据缓存寄存器，物理上是两个独立的寄存器，但占用相同的地址。**写操作**时，发送的是发送寄存器，**读操作**时，读出的是接收寄存器

![image-20251016202033092](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016202033092.png)

### 6.9 数据显示模式

- HEX模式/十六进制模式/二进制模式：以原始数据的形式显示
- 文本模式/字符模式： 以原始数据编码后的形式显示

## 7. LED点阵屏

- LED点阵屏是由若干个独立的LED组成，LED以矩阵的形式排列，以灯珠亮灭来显示文字、图片、视频等。LED点阵屏广泛应用于各种公共场合
- LED点阵屏分类
  - 按颜色： 单色、双色、全彩
  - 按像素：8x8、16x16等（大规模的LED点阵通常由很多个小点阵拼接而成）

### 7.1 显示原理

- 其结构类似于数码管，只不过是数码管把每一列的像素以“8”字形排列
- 与数码管一样，有共阴极和共阳极两种解法，不同的解法对应的电路结构不同
- 需要进行逐行或逐列扫描，才能使所有的LED同时显示

### 7.2 开发板引脚对应关系

![image-20251016231941567](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016231941567.png)

### 7.3 74HC595 ==串转并==

串行输入并行输出的移位寄存器，可用3根输入串行数据，8根线输出并行数据，多片级联后，可输出16位、24位、32位等，常用于IO扩展

![image-20251016232532901](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016232532901.png)

- `OE`：使能端，低电平有效
- `RCLK/STCP`：存储寄存器时钟输入，**上升沿**时，数据从移位寄存器转存到存储寄存器中
- `SRCLR/MR`：serial clear 串行清零端
- `SRCLK/SHCP`：移位寄存器时钟，**上升沿**时，移位寄存器中的`bit`数据整体后移，并接受新的从`SER`中输入的`bit`
- `SER/DS`：串行数据输入，**先输入高位
- `QH'`：串行数据出口，**当移位寄存器中的数据多于8`bit`时，会把已有的`bit`挤出去**，用于级联

![image-20251016232202036](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1016/image-20251016232202036.png)

### 7.4 C51的sfr、sbit

- `sfr`：特殊功能寄存器声明
- `sbit`：特殊位声明

> 可位寻址/不可位寻址：



## 8. DS1302

是由美国DALLAS公司推出的具有涓细电流充电能力的低功耗实时时钟芯片。他可以对年月日周时分秒进行计时，且具有闰年补偿等多种功能

`RTC`：实时时钟，是一种集成电路，通常称为时钟芯片  （DS3231也是，精度更高）

1. `RTC`计算年、月、日、时、分、秒、星期，==直到2100年==，有==闰年调节功能==。有`AM/PM`指示器
2. 电压范围：2.0-5.5v
3. 与==TTL==兼容
4. 有31Byte的静态RAM，还附加==7Byte的暂存器==

> [!note]
>
> 涓细电路：*其内置的可编程电路，能够以非常微小的电流作为备用电池（或超级电容）充电*

###  8.1 引脚定义和应用电路

![image-20251017154500911](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1017/image-20251017154500911.png)

- `vcc1`：备用电源
- `vcc2`：主电源
- `gnd`：电源地
- `x1、x2`：晶振 32.768KHz
- `CE`：chip enable 芯片使能  ==还需一个40k的下拉电阻连接到地==
- `SCLK`：串行时钟 ==还需一个40k的下拉电阻连接到地==
- `I/O`：输入/推挽输出 ==还需一个40k的下拉电阻连接到地==
  - [推挽输出](https://zh.wikipedia.org/zh-cn/%E6%8E%A8%E6%8C%BD%E8%BE%93%E5%87%BA)：一种使用一对选择性地从相连负载灌电流或者拉电流的器件的电路

单片机与时钟/RAM通讯只需要`CE`、`I/O`、和`SCLK`三根线

### 8.2 命令字

> [!note]
>
> 命令字：CPU对设备发出的具体命令

![image-20251022191242941](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1022/image-20251022191242941.png)

- 命令字启动每一次数据传输，`MSB`（位7）必须置1，如果是0,则禁止对`DS1302`写入
- 位6在逻辑0时规定时钟/日历数据，逻辑1为`RAM`数据
- 位1至位5表示输入输出的指定寄存器
- `LSB`（位0）在逻辑0为写操作，逻辑1为读操作 （==**从低位开始**==）

### 8.3 数据输入与输出

![image-20251022191931252](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1022/image-20251022191931252.png)

1. 上电时需保证`CE=0`，`SCLK=0`
2. 传输和读取数据时应维持`CE=1`
3. 写入命令字

![image-20251022192425044](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1022/image-20251022192425044.png)

- 需先写入命令字

### 8.2 BCD码

BCD码转十进制：`DEC=BCD/16*10+BCD%16`

十进制转BCD码：`BCD=DEC/10*16+DEC%16`

 

## 9. 蜂鸣器

![image-20251022201651578](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1022/image-20251022201651578.png)

- 引脚为P2^5
- 分为有源蜂鸣器和无源蜂鸣器 **有无震荡源**
  - 有源蜂鸣器/自激式蜂鸣器
    - 优势：程序控制方便
  - 无源蜂鸣器/他激式蜂鸣器
    - 优势：便宜、声音频率可控、可与LED共用引脚
  - 单片机驱动他激蜂鸣器的方式有两种：一种是**PWM输出口直接驱动**，另一种是利用**I/O 定时翻转电平**产生驱动波形对蜂鸣器进行驱动

## 10. AT24C02介绍

- AT24C02是一种**可实现掉电不丢失**的存储器，可用于保存单片机运行时想要永久保存的数据信息
- 存储介质：E2PROM
- 通讯接口：**I2C总线**
- 容量：256字节

![image-20251018160317137](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018160317137.png)

### 10.1 存储器介绍

1. 易失性存储器（RAM：Random-access memory）

   优势：读写速度快

   缺点：掉电丢失

   - SRAM（静态RAM）
   - DRAM（动态RAM）

2. 非易失性存储器（ROM：Read-only memory）

   优势：掉电不丢失

   缺点：读写速度慢

   - Mask ROM（掩膜ROM）
   - PROM（可编程ROM）
   - EPROM（可擦除可编程ROM）
   - E2PROM（电可擦除可编程ROM）
   - Flash（闪存）
   - 硬盘、软盘、光盘等

### 10.2 I2C总线 （Inter IC Bus）[^1]

是由Philips公司开发的一种通用数据总线

- 拥有两根通信线：SCL(Serial Clock)、SDA(Serial Data)
- 同步、半双工，带数据应答，串行发送
- 通用的I2C总线可以使各个设备的通信标准统一，对与厂家而言，使用成熟的方案可以缩短芯片设计周期，提高稳定性，对于应用者来说，使用通用的通信协议可以避免学习各种各样的自定义协议，降低学习和应用的难度
- 优势：
  - 接口线少
  - 控制方式简单
  - 器件封装小
  - 通信速率较高
  - 可拓展性强


1. I2C电路规范

   - 所有I2C设备的SCL连在一起，SDA连在一起
   - 设备的SCL和SDA均要配置成开漏输出模式
   - SCL和SDA各添加一个上拉电阻，阻值一般为4.7K左右
   - 开漏输出和上拉电阻的共同作用实现了“线与”的功能，此设计主要是为了解决多机通信互相干扰的问题

   > 开漏输出模式：是一种常见的数字电路输出模式
   >
   > - **核心原理：只能拉低不能推高**
   >
   > 上拉电阻：为了让开漏输出能够正常输出高电平，**必须在外部连接一个上拉电阻（Pull-up Resistor）**，电阻的一端连接到输出引脚，另一端连接到正电源（VCC）
   >
   > 线与：任意一个器件输出的低电平都将把总线的信号变低

![image-20251018161543229](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018161543229.png)

2. I2C时序结构
   - 起始条件：SCL高电平期间，SDA从高电平切换到低电平
   - 终止条件：SCL高电平期间，SDA从低电平切换到高电平
   - 发送一个字节：SCL低电平期间，主机将数据位一次放到SDA线上（**高位在前**），然后拉高SCL，从机将在SCL高电平期间读取数据位，所以SCL高电平期间SDA不允许由数据变化，依次循环上述过程8次，即可发送一个字节
   - 接收一个字节：SCL低电平期间，从机从数据位一次放到SDA线上（**高位在前**），然后拉高SCL，从机将在SCL高电平期间读取数据位，所以SCL高电平期间SDA不允许由数据变化，依次循环上述过程8次，即可接收一个字节（**主机在接收前，需要释放SDA**）
   - 发送与接收应答
     - 发送应答：在接受完一个字节后，主机在下一个时钟发送一位数据，数据0表示应答，7数据1表示非应答
     - 接收应答：再发送完一个字节后，主机在下一个时钟接收一个数据，判断从机是否应答，数据0表示应答，7数据1表示非应答（**主机接收前，需要释放SDA**）
   - 

![image-20251018190050219](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018190050219.png)

![image-20251018190414488](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018190414488.png)

![image-20251018191030912](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018191030912.png)

![image-20251018201209856](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018201209856.png)

<!-- ACK (acknowledgement character)命令正确应答；确认字符 -->

3. I2C数据帧

   1. 发送一帧数据 *此处发送数据最后一位给0*	

      完成任务：向谁发什么

   ![image-20251018201700149](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018201700149.png)

   其中第一个发送的数据代表从机地址和读写操作，最低位告知SDA是读操作还是写操作，高四位固定，`A2\A1\A0`为从机地址

   2. 接收一帧数据 *此处发送数据最后一位给1*

      完成任务：向谁收什么

   ![image-20251018202602422](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018202602422.png)

   3. 先发送再接收数据帧（复合模式）

      完成任务：向谁指定什么

   ![image-20251018202818006](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018202818006.png)

4. AT24C02数据帧

   - 字节写：在`WORD ADDRESS`处写入数据`DATA`

   ![image-20251018203653644](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018203653644.png)

   - 随机读：读出在`WORD ADDRESS`处的数据`DATA`

   ![image-20251018203605612](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1018/image-20251018203605612.png)

   - `AT24C02`的固定地址为1010,可配置地址。 开发板上的地址为`000`，所以`SLAVE ADDRESS+W`为`0xA0`，`SLAVE ADDRESS+R`为`0xA1`

## 11. DS18B20温度传感器

- DS18B20是一种常见的数字温度传感器，其控制命令和数据都是以数字信号的方式输入输出，相比较于模拟温度传感器，具有功能强大、硬件简单、易扩展、抗干扰性强等特点
- 测温范围：-55到+125
- 通信接口：1-wire（单总线）
- 其他特征：可形成总线结构、内置温度报警功能、可寄生供电

> [寄生供电](https://baike.baidu.com/item/%E5%AF%84%E7%94%9F%E9%9B%BB%E6%BA%90/1492461 "寄生电源 百度百科")：
>
> - 一种通过单线总线接口或无线射频信号耦合获取电能的供电方式
> - 主要应用于数字温度传感器和RFID电子标签等设备
> - 核心原理：利用总线高电平存储电荷，低电平时由内部电容供电，实现无须外接电源的简化设计，适用于嵌入式和低功耗
>
> 数字温度传感器与模拟温度传感器：
>
> [参考](https://www.weifengheng.com/show-3139.html#:~:text=%E4%B8%80%E3%80%81%E4%BF%A1%E5%8F%B7%E8%BE%93%E5%87%BA%E5%BD%A2%E5%BC%8F%E4%B8%8A,%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90%E5%92%8C%E7%A8%B3%E5%AE%9A%E9%80%9A%E4%BF%A1%E3%80%82 "数字传感器与模拟传感器的区别")
>
> - 区别
>   - 信号输出形式的根本差别：模拟传感器时连续的电信号；数字传感器则是离散的数字信号
>   - 内部结构与工作机制的不同：模拟传感器设计简单，由**敏感元件*构成；数字传感器则更为复杂，还需内置*模数转换器（ADC）、数字处理单元、微控制单元或信号调理模块等*
>   - 抗干扰能力的显著差别：模拟传感器差；数字传感器具备一定的抗干扰能力
>   - 信号处理与系统集成的便携性：数字传感器的优势

### 11.1 引脚和应用电路

TO92分封装

| 引脚 | 功能              |
| ---- | ----------------- |
| VDD  | 电源（3.0v-5.5v） |
| GND  | 电源地            |
| DQ   | 单总线接口        |

![image-20251019100750271](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019100750271.png)

> [!note]
>
> - 基于三极管`BJT`电路的命名
>   - `VCC`：连接到**集电极**的公共电源电压 Conllector   -->正极
>   - `VEE`：连接到**发射极**的公共电源电压 Emitter   -->负极
> - 基于场效应管`FET`电路的命名
>   - `VDD`：连接到**漏极**的电源电压 Drain  -->正极
>   - `VSS`：连接到**源极**的公共参考点  Source   -->负极

### 11.2 内部结构框图

- 64-BIT ROM：作为器件地址，用于总线通讯的寻址
- SCRATCHPAD（暂存器 ROM）：用于总线的数据交互
- EEPROM：用于保存温度触发阈值和配置参数

![image-20251019113837533](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019113837533.png)

### 11.3 存储器结构

- Byte0和Byte1共同存储温度值
- Byte2对应高预警值
- Byte3对应低预警值
- Byte4对应相关配置
- Byte5-Byte7保留
- Byte8为CRC校验

![image-20251019114756725](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019114756725.png)

> MSB(Most Significant Bit): 二进制的最左侧
>
> LSB(Least Significant Bit): 二进制的最右侧

### 11.4 单总线 One-wire

#### 11.4.1 介绍

- 由Dallas公司开发的一种通用数据总线
- 一根通信线：DQ
- 异步、半双工
- 单总线只需要一根通信线即可实现数据的双向传输，当采用寄生供电时，还可省去设备的VDD线路，此外，供电加通信只需要DQ和GND两根线

#### 11.4.2 单总线电路规范

- 设备的DQ均要配置为开漏输出模式
- D Q添加一个上拉电阻，阻值一般为4.7K
- 若此总线的从机采取寄生供电，则主机还应配一个强上拉输出电路

#### 11.4.3 单总线时序结构

1. 初始化：主机将总线拉低至少480us，然后释放总线，等待15-60us后，存在的从机会拉低总线60-240us以响应主机，之后从机释放总线

![image-20251019120208781](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019120208781.png)

2. 发送一位：主机将总线拉低60-120us，然后释放总线，表示发送0；主机将总线拉低1-15us，然后释放总线，表示发送1.从机将在总线拉低30us（典型值）读取电平，整个时间片应大于60us

![image-20251019120721756](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019120721756.png)

3. 接收一位：主机将总线拉低1-15us，然后释放总线，并在拉低后15us内读取总线电平（尽量贴近15us的末尾），读取为低电平则为接收0,读取到高电平则为接收1,整个时间片应大于60us

![image-20251019121230436](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019121230436.png)

4. 发送（接收）一个字节

​	连续调用8次发送（接收）一位的时序，一次发送一个字节的8位（==低位在前==）

![image-20251019121754849](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019121754849.png)

![image-20251019121802887](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019121802887.png)

### 11.5 DS18C02操作流程

- 初始化：从机复位，主机判断从机是否响应
- ROM操作：ROM指令+本指令需要的读写操作
- 功能操作：功能指令+本指令需要的读写操作

![image-20251019122108323](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019122108323.png)

### 11.6 DS18B02数据帧

- 温度变换：初始化-->跳过ROM-->开始温度变换

![image-20251019122801850](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019122801850.png)

**“跳过ROM”**

![image-20251023173626867](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1023/image-20251023173626867.png)

- 温度读取：初始化-->跳过ROM-->读暂存器-->连续的读操作

![image-20251019122810801](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019122810801.png)

### 11.7 温度存储格式

- 存储的为**补码**

![image-20251019123234891](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019123234891.png)

**由于`LSB`中的第四位用于存储小数，故在读取温度时应右移4位，即`/16.0`**

## 12. LCD1602

- 是一种字符型液晶显示模块，可以显示ASCII码的标准字符和其他一些内置特殊字符，还可以有八个字定义字符
- 显示容量：16x2个字符，没个字符为5*7点阵

### 12.1 引脚及应用电路

| 引脚  | 功能                              |
| ----- | --------------------------------- |
| VSS   | 地                                |
| VDD   | 电源正极（4.5v~5.5v）             |
| VO    | 对比度调节电压                    |
| RS    | 数据/指令选择，1为数据，0为指令   |
| RW    | 读/写选择，1为读，0为写           |
| E     | 使能，1为数据有效，下降沿执行命令 |
| D0~D7 | 数据输入/输出                     |
| A     | 背光灯电源正极                    |
| K     | 背光灯电源负极                    |

![image-20251019230559910](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019230559910.png)

内部框图

- 其中DDRAM中可存储40x2的数据，然而LCD1602仅能展示16x2的数据，可由移位指令实现流动字幕
- CGRAM可自定义字模，但是==掉电会丢失==

![image-20251019231627343](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019231627343.png)

存储器结构

DDRAM （数据显示区 40*2）

![image-20251019231925735](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019231925735.png)

CGRAM+CGROM（字模库）

![lcdcc_4](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/lcdcc_4.jpeg)

### 12.2 时序结构

- 写数据/指令

![image-20251019232413956](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/image-20251019232413956.png)

### 12.3 LCD1602指令集

![LCD1602指令集](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1019/LCD1602指令集.png)

### 12.4 LCD1602操作流程

- 初始化
  - 发送指令0x38 // 八位数据接口，两行显示，5*7点阵
  - 发送指令0x0C // 显示开，光标关，闪烁关
  - 发送指令0x06 // 数据读写操作后，光标加一，画面不动
  - 发送指令0x01 // 清屏
- 显示字符
  - 发送指令0x80|AC // 设置光标位置
  - 发送数据 // 发送要显示的字符数据
  - 发送数据 // 发送要显示的字符数据
  - ...



## 13. 直流电机

- 是一种将电能转换为机械能的装置。通常有两个电极，当电极正接时，电机正转，当电极反接时，电机反转
- 直流电机主要由永磁体（定子）、线圈（转子）和换向器组成
- 除了直流电机外，常见的电机还有步进电机、舵机、无刷电机、空心杯电机等

### 13.1 电机驱动电路

- 大功率器件直接驱动

![image-20251020153351902](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020153351902.png)

- H桥驱动

![image-20251020153401798](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020153401798.png)

### 12.2 PWM介绍

- PWM(Pulse Width Modulation) 即脉冲宽度调制，在具有惯性的系统中，可以通过对一系列脉冲的宽度进行调制，来等效地获取所需要的模拟参量，常用于电机控速、开关电源等领域
- PWM重要参数
  - 频率 = 1/T~S~[^2]
  - 占空比 = T~ON~[^3]/T~S~
  - 精度 = 占空比变化步距

## 13. AD/DA

- AD（Analog to Digital）：模拟-数字转换，将模拟信号转换为计算机可操作的数字信号
- DA（Digital to Analog）：数字-模拟转换，将计算机输出的数字信号转换为模拟信号
- AD/DA转换打开了计算机与模拟信号的大门，极大地提高了计算机系统的应用范围，也为模拟信号数字化处理提供了可能

### 13.1 硬件电路模型

- AD转换通常有多个输入通道，用多路选择开关连接至AD转换器，以实现AD多路复用的目的，提高硬件利用率
- AD/DA与单片机数据传送可使用并口（速度快，原理简单），也可以使用串口（接线少，使用方便）
- 可将AD/DA模块直接集成到单片机内，这样直接写入/读出寄存器就可进行AD/DA转换，单片机的IO口可直接复用为AD/DA的通道

![image-20251020181513037](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020181513037.png)

### 13.2 运算放大器

- 运算放大器是具有很高放大倍数的放大电路单元。内部集成了差分放大器、电压放大器、功率放大器三级放大电路，是一个性能完备、功能强大的通用放大电路单元，由于其应用十分广泛，现已作为基本的电路元件出现在电路图中
- 运算放大器可构成的电路有：电压比较器、反向放大器、同向放大器、电压跟随器、加法器、积分器、微分器等
- 运算放大器电路的分析方法：虚短、虚断（==负反馈下==）

![image-20251020182709080](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020182709080.png)

### 13.3 DA原理

![image-20251020193915124](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020193915124.png)

![image-20251020194057140](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020194057140.png)

### 13.4 AD原理

![image-20251020195317842](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020195317842.png)

### 13.5 AD/DA性能指标

- 分辨率：指AD/DA数字量的精细程度
- 转换速度：表示AD/DA的最大采样/建立频率，通常用转换频率或者转换时间来表示

### 13.6 XPT2046

4线制电阻式触摸屏控制器，内含12位分辨率125KHz转换速率逐步逼近型A/D转换器。支持**1.5v到5.25v**的低电压I/O接口

- 数据接口为**串行接口**
- 处理器与转换器之间的通信需要8个时钟周期，可采用`SPI`、`SSI`和`Microwire`等同步串行接口
- 一次完整的转换需要24个串行同步时钟`DCLK`来完成

#### 13.6.1 数据接口

1. 前八个时钟用来通过`DIN`输入控制字节。
   - `S`: 起始位`MSB` 控制字的首位==必须置1==
   - `A(1:3)`: 接下来的3位选择多路选择器的现行通道，触摸屏驱动和参考源输入
   - `MODE`: 模式选择位，用于设置`ADC`的分辨率。置零为**12位模式**，置一位**8位模式**
   - `SER/DFR`： 置一位单端模式，置零为差分模式
   - `PD0`、`PD1`: 掉电和内部参考电压配置的关系

![image-20251023224928542](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1023/image-20251023224928542.png)

2. 3个多时钟周期后，控制字节设置完成，转换器进入转换状态
3. 接下来的12个时钟周期
   - 如果是单端模式，驱动器在转换过程中将一直工作



## 14. 红外遥控器

红外遥控是利用红外光进行通信的设备，由红外LED将调制后的信号发出，由专用的红外接收头进行解调输出

- 通信方式：单工、异步
- 红外LED波长为940nm
- 通信协议标准为NEC标准

### 14.1 硬件电路

![image-20251020215552745](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020215552745.png)

- 38KHz支路是为了抗干扰
- 前两个电路为发送电路

### 14.2 基本发送与接收

- 空闲状态：红外LED不亮，接收头输出高电平
- 发送低电平：红外LED以38KHz频率闪烁发光，接收头输出低电平
- 发送高电平：红外LED不亮，接收头输出高电平

### 14.3 NEC编码

![image-20251020222857625](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020222857625.png)

### 14.3 遥控器键码

![image-20251020223329507](https://raw.githubusercontent.com/camus0809/Typora_Image/devw/Image_2025/1020/image-20251020223329507.png)

### 14.4 外部中断

- STC89C52有4个外部中断
- 两种触发方式：高电平和下降沿
- 中断号
  - 外部中断0 `interrupt 0`  -->P3^2
  - 外部中断1 `interrupt 2` --> p3^3
  - 外部中断3 `interrupt 6`
  - 外部中断4 `interrupt 7`



[^1]: 普中开发攻略p185
[^2]: 一个脉冲的周期
[^3]: 一个脉冲中打开的时间

